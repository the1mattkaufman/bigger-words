<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bigger Words</title>
    <style>
      .definition {
        color: black;
        border-style: solid;
        background-color: lightgrey;
      }
      .hide {
        display: none;
      }
      .button {
        margin-top:10px;
      }
      .green {
        background-color: #4CAF50;
      }
      .red {
        background-color: red;
      }
      .left {
        left:0;
        margin-left: 10px;
        position: absolute;
      }
      .right {
        margin-right: 10px;
        position: absolute;
        right: 0;
      }
      .top {
        margin-top: 10px;
        position: absolute;
        top:0;
      }
      .bottom {
        bottom:0;
        margin-bottom: 10px;
        position: absolute;
      }
      .loginButton {
        background: rgb(66, 133, 244);
        border: 1px solid #4285f4;
        outline: none;
        color: white;
        font-weight: bold;
        line-height: 28px;
        padding: 0 12px;
      }
    </style> 
  </head>
  <body onload="getNext()" >
    <header>
      <div style="width:100%; text-align: center;" >
        <h1>Bigger Words</h1>
      </div>
      <div class="top right" style="text-align:right;" >
        <div style="margin:10px;" >
          <button id="loginButton" class="loginButton" onclick="toggleSignIn();">Sign In</button>
          <image id="photoURL" class="hide" src="" onclick="toggleSignIn();" style="border-radius: 50%; height: 25px; width: 25px;" />
        </div>
        <div style="margin:10px;" >
          <span id="displayName" >Your Score</span>
          <div>Right: <span id="timesRight"></span></div>
          <div>Wrong: <span id="timesWrong"></span></div>
        </div>
      </div>
    </header>
    <section style="margin: auto; margin-top:120px; min-height:200px;" >
        <div>
          <center>
            <div >
              <p>
                <h1 id="word"></h1>
              </p>
            </div>
            <div onclick="showDefinition();" >
              <p>
                <h3 id="definition" class="definition" ></h3>
              </p>
            </div>
            <button id="showButton" onclick="showDefinition()" class="button" >Show Definition</button>
            <button id="rightButton" onclick="calcScore('right')" class="button, green" >I was right</button>
            <button id="wrongButton" onclick="calcScore('wrong')" class="button, red" >I was wrong</button>
          </center>          
        </div>
    </section>
    <footer>
      <div class="bottom left" style="text-align: center;" >
        <image src="https://chart.googleapis.com/chart?choe=UTF-8&cht=qr&chs=100x100&chl=http%3A%2F%2Fbit.ly%2FbiggerWordsApp" /><br/>
        <a href="http://bit.ly/biggerWordsApp" >bit.ly/biggerWordsApp</a>
      </div>
      <div class="bottom right" style="text-align: center;" >
        <image src="https://chart.googleapis.com/chart?choe=UTF-8&cht=qr&chs=100x100&chl=http://bit.ly/biggerWordsGithub" /><br/>
        <a href="http://bit.ly/biggerWordsGithub" >bit.ly/biggerWordsGithub</a>
      </div>
    </footer>

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script defer src="/__/firebase/6.2.3/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script defer src="/__/firebase/6.2.3/firebase-auth.js"></script>
    <script defer src="/__/firebase/6.2.3/firebase-firestore.js"></script>
    <script defer src="/__/firebase/6.2.3/firebase-functions.js"></script>

    <!-- Initialize Firebase -->
    <script defer src="/__/firebase/init.js"></script>

    <script type="application/javascript">
      let player = { timesRight: 0, timesWrong: 0, uid: '', photoURL: '', displayName: '' };
      let currentItem;
      let itemList = [
        { word:'lexicomane', definition:'lover of a dictionary'},        
        { word:'avaricious', definition:'having or showing an extreme greed for wealth or material gain'},
        { word:'apprehension', definition:'a feeling of fear that something bad may happen'},
        { word:'consider', definition:'deem to be'},
        { word:'minute', definition:'infinitely or immeasurably small'},
        { word:'accord', definition:'concurrence of opinion'},
        { word:'evident', definition:'clearly revealed to the mind or the senses or judgment'},
        { word:'practice', definition:'a customary way of operation or behavior'},
        { word:'intend', definition:'have in mind as a purpose'},
        { word:'concern', definition:'something that interests you because it is important'},
        { word:'commit', definition:'perform an act, usually with a negative connotation'},
        { word:'issue', definition:'some situation or event that is thought about'},
        { word:'approach', definition:'move towards'}
      ];
      let getNext = () => {
        let randomNum = Math.floor(Math.random()*itemList.length);
        currentItem = itemList[randomNum];
        document.getElementById('timesRight').textContent = player.timesRight;
        document.getElementById('timesWrong').textContent = player.timesWrong;
        document.getElementById('word').textContent = currentItem.word;
        document.getElementById('definition').textContent = currentItem.definition;
        toggle('definition');
        toggle('rightButton');
        toggle('wrongButton');
      }
      let showDefinition = () => {
        toggle('definition');
        toggle('showButton');
        toggle('rightButton');
        toggle('wrongButton');
      }
      let calcScore = (result) => {
        if ( result == 'right' ){
          player.timesRight++;
        } else {
          player.timesWrong++;
        }
        toggle('showButton');
        getNext();
      }
      let toggle = (tagId) =>{
        let tag = document.getElementById(tagId);
        tag.classList.toggle('hide');
      }

      /**
        START FIREBASE
      */
      let toggleSignIn = () => {
        if (!firebase.auth().currentUser) {
          let provider = new firebase.auth.GoogleAuthProvider();
          provider.addScope('https://www.googleapis.com/auth/userinfo.profile');
          firebase.auth().signInWithRedirect(provider);    
        } else {
          // Sign-out successful.
          firebase.auth().signOut()
        }
        setPlayer();
      }

      let initApp = () => {
        firebase.auth().getRedirectResult().then((result) => {
          console.log( 'getRedirectResult()', result );
          if (result.credential) {
            let token = result.credential.accessToken;
          }
          let user = result.user;
          setPlayer(user);
        }).catch(function(error) {
          let errorCode = error.code;
          let errorMessage = error.message;
          let email = error.email;
          let credential = error.credential;
          console.log( error );
        });
        
        firebase.auth().onAuthStateChanged((user) => {
          setPlayer(user);
        });
      }
      let setPlayer = (user) => {
        console.info(user);
        document.getElementById('photoURL').classList.add('hide');
        document.getElementById('loginButton').classList.remove('hide');
        if ( user && user.uid ){
          let email = user.email;
          let emailVerified = user.emailVerified;
          let isAnonymous = user.isAnonymous;
          let providerData = user.providerData;
          player.displayName = user.displayName;
          document.getElementById('displayName').innerText = player.displayName;
          player.photoURL = user.photoURL;
          document.getElementById('photoURL').src = player.photoURL;
          document.getElementById('photoURL').classList.remove('hide');
          document.getElementById('loginButton').classList.add('hide');
          player.uid = user.uid;
        }
      }
      document.addEventListener('DOMContentLoaded', function() {
        initApp();
      });

    </script>

  </body>
</html>